<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงุณุชุฎุฏุงู LongLLMLinguaPostprocessor ุนูููุงู</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); min-height: 100vh; padding: 20px; line-height: 1.8; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: rgba(255, 255, 255, 0.95); padding: 30px; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); margin-bottom: 30px; text-align: center; }
        .card { background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 30px; margin-bottom: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); transition: transform 0.3s ease; }
        .card:hover { transform: translateY(-5px); }
        .card h2 { color: #2c3e50; font-size: 1.8em; margin-bottom: 20px; border-bottom: 3px solid #74b9ff; padding-bottom: 10px; }
        .code-box { background: #2c3e50; padding: 20px; border-radius: 15px; margin: 20px 0; color: #ecf0f1; font-family: 'Courier New', monospace; overflow-x: auto; direction: ltr; text-align: left; }
        .usage-box { background: linear-gradient(120deg, #74b9ff 0%, #0984e3 100%); padding: 20px; border-radius: 15px; margin: 20px 0; color: white; }
        .practical-box { background: linear-gradient(120deg, #00b894 0%, #00cec9 100%); padding: 20px; border-radius: 15px; margin: 20px 0; color: white; }
        .example-box { background: linear-gradient(120deg, #fdcb6e 0%, #e17055 100%); padding: 20px; border-radius: 15px; margin: 20px 0; color: white; }
        .tips-box { background: linear-gradient(120deg, #fd79a8 0%, #e84393 100%); padding: 20px; border-radius: 15px; margin: 20px 0; color: white; }
        .footer { background: rgba(44, 62, 80, 0.9); color: white; text-align: center; padding: 20px; border-radius: 15px; }
        .step-number { background: #2c3e50; color: white; width: 30px; height: 30px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; margin-left: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>๐ป ุงุณุชุฎุฏุงู LongLLMLinguaPostprocessor ุนูููุงู</h1>
            <p>ุงูุฏุฑุณ ุงูุซุงูู: ูู ุงูุชุซุจูุช ููุชุทุจูู - ุฏููู ุดุงูู</p>
        </div>

        <div class="card">
            <h2>๐ ุงูุชุซุจูุช ูุงูุฅุนุฏุงุฏ ุงูุฃููู</h2>
            <div class="usage-box">
                <h3><span class="step-number">1</span>ุชุซุจูุช ุงูููุชุจุงุช ุงููุทููุจุฉ:</h3>
                <p>ูุจู ูุง ูุจุฏุฃุ ูุงุฒู ูุชุฃูุฏ ุฅู ูู ุงูุญุงุฌุงุช ุงููุทููุจุฉ ูุซุจุชุฉ!</p>
                
                <div class="code-box">
# ุชุซุจูุช LlamaIndex ูุน ุฏุนู LongLLMLingua
pip install llama-index
pip install llama-index-postprocessor-longllmlingua

# ุชุซุจูุช ุงูููุชุจุงุช ุงููุณุงุนุฏุฉ
pip install transformers torch
pip install accelerate  # ููุฃุฏุงุก ุงูุฃูุถู
                </div>
                
                <h3><span class="step-number">2</span>ุงูุชุญูู ูู ุงูุชุซุจูุช:</h3>
                <div class="code-box">
# ุงุฎุชุจุงุฑ ุณุฑูุน ููุชุฃูุฏ ุฅู ูู ุดูุก ุดุบุงู
try:
    from llama_index.postprocessor.longllmlingua import LongLLMLinguaPostprocessor
    print("โ ุงูุชุซุจูุช ุชู ุจูุฌุงุญ!")
except ImportError as e:
    print(f"โ ูุดููุฉ ูู ุงูุชุซุจูุช: {e}")
                </div>
                
                <h3>โ๏ธ ูุชุทูุจุงุช ุงููุธุงู:</h3>
                <ul>
                    <li><strong>Python:</strong> 3.8 ุฃู ุฃุญุฏุซ</li>
                    <li><strong>Memory:</strong> 4GB RAM ุนูู ุงูุฃูู</li>
                    <li><strong>Storage:</strong> 2GB ูุณุงุญุฉ ููููุฏููุงุช</li>
                    <li><strong>GPU:</strong> ุงุฎุชูุงุฑู ููู ูุญุณู ุงูุฃุฏุงุก ูุซูุฑุงู</li>
                </ul>
            </div>
        </div>

        <div class="card">
            <h2>โ๏ธ ุงูุฅุนุฏุงุฏ ุงูุฃุณุงุณู ูุงูุชูููู</h2>
            <div class="practical-box">
                <h3><span class="step-number">3</span>ุฅูุดุงุก Postprocessor ุจุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ:</h3>
                <div class="code-box">
from llama_index.postprocessor.longllmlingua import LongLLMLinguaPostprocessor

# ุงูุทุฑููุฉ ุงูุฃุจุณุท - ุฅุนุฏุงุฏุงุช ุงูุชุฑุงุถูุฉ
postprocessor = LongLLMLinguaPostprocessor()

print("๐ฏ ุชู ุฅูุดุงุก ุงูู postprocessor ุจูุฌุงุญ!")
print(f"๐ ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ:")
print(f"   - Target Token: {postprocessor.target_token}")
print(f"   - Rank Method: {postprocessor.rank_method}")
print(f"   - Additional Compress: {postprocessor.additional_compress}")
                </div>
                
                <h3><span class="step-number">4</span>ุฅุนุฏุงุฏ ูุฎุตุต ุญุณุจ ุงุญุชูุงุฌุงุชู:</h3>
                <div class="code-box">
# ุฅุนุฏุงุฏ ูุชูุฏู ูุน ุชุญูู ูุงูู
postprocessor = LongLLMLinguaPostprocessor(
    instruction_str="ุฃุฌุจ ุนูู ุงูุณุคุงู ุจุฏูุฉ ูุงุฎุชุตุงุฑ",  # ุชุนูููุงุช ูุฎุตุตุฉ
    target_token=300,                                      # ูุฏู ุนุฏุฏ ุงููููุงุช
    rank_method="longllmlingua",                          # ุทุฑููุฉ ุงูุชุฑุชูุจ
    additional_compress=0.1,                              # ุถุบุท ุฅุถุงูู 10%
    condition_compare=True,                               # ููุงุฑูุฉ ุงูุดุฑูุท
    context_budget="+100",                                # ููุฒุงููุฉ ุฅุถุงููุฉ
    reorder_context="sort"                                # ุฅุนุงุฏุฉ ุชุฑุชูุจ
)

print("โ๏ธ ุฅุนุฏุงุฏ ูุฎุตุต ุชู ุจูุฌุงุญ!")
                </div>
                
                <h3>๐๏ธ ุดุฑุญ ุงููุนุงููุงุช ุงููููุฉ:</h3>
                <ul>
                    <li><strong>target_token:</strong> ุนุฏุฏ ุงููููุงุช ุงููุทููุจ ุงููุตูู ุฅููู</li>
                    <li><strong>rank_method:</strong> ุทุฑููุฉ ุชุฑุชูุจ ุฃูููุฉ ุงููุญุชูู</li>
                    <li><strong>additional_compress:</strong> ูุณุจุฉ ุถุบุท ุฅุถุงููุฉ</li>
                    <li><strong>condition_compare:</strong> ููุงุฑูุฉ ุฐููุฉ ููุดุฑูุท</li>
                    <li><strong>context_budget:</strong> ุญุฌู ุงููุญุชูู ุงููุณููุญ</li>
                </ul>
            </div>
        </div>

        <div class="card">
            <h2>๐ ุงุณุชุฎุฏุงู ุนููู ุฎุทูุฉ ุจุฎุทูุฉ</h2>
            <div class="example-box">
                <h3><span class="step-number">5</span>ูุซุงู ูุงูู - ูู ุงูุจุฏุงูุฉ ููููุงูุฉ:</h3>
                <div class="code-box">
from llama_index.core import VectorStoreIndex, SimpleDirectoryReader
from llama_index.core.postprocessor import LongLLMLinguaPostprocessor
from llama_index.llms.openai import OpenAI

# 1. ุชุญููู ุงูุจูุงูุงุช
print("๐ ุชุญููู ุงูุจูุงูุงุช...")
documents = SimpleDirectoryReader("./data").load_data()

# 2. ุฅูุดุงุก ุงูููุฑุณ
print("๐ ุฅูุดุงุก ุงูููุฑุณ...")
index = VectorStoreIndex.from_documents(documents)

# 3. ุฅุนุฏุงุฏ ุงูู LLM
print("๐ค ุฅุนุฏุงุฏ ุงููููุฐุฌ...")
llm = OpenAI(model="gpt-3.5-turbo", temperature=0.1)

# 4. ุฅูุดุงุก ุงูู postprocessor
print("โ๏ธ ุฅุนุฏุงุฏ ุงูุถุบุท...")
postprocessor = LongLLMLinguaPostprocessor(
    target_token=500,               # ูุฑูุฏ 500 ูููุฉ ูุญุฏ ุฃูุตู
    rank_method="longllmlingua",    # ุงุณุชุฎุฏู ุงูุทุฑููุฉ ุงููุชูุฏูุฉ
    additional_compress=0.1         # ุถุบุท ุฅุถุงูู 10%
)

# 5. ุฅูุดุงุก Query Engine ูุน ุงูู postprocessor
print("๐ง ุฑุจุท ุงูููููุงุช...")
query_engine = index.as_query_engine(
    llm=llm,
    node_postprocessors=[postprocessor],  # ููุง ุงูุณุญุฑ!
    similarity_top_k=10                   # ุฌูุจ ุฃูู 10 ูุชุงุฆุฌ
)

# 6. ุงูุณุคุงู ูุงูุญุตูู ุนูู ุฅุฌุงุจุฉ
print("โ ุทุฑุญ ุงูุณุคุงู...")
question = "ูุง ูู ุฃูู ููุงุฆุฏ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูู ุงูุชุนูููุ"
response = query_engine.query(question)

print(f"โ ุงูุฅุฌุงุจุฉ: {response}")
print(f"๐ ุนุฏุฏ ุงููููุงุช ูู ุงููุตุงุฏุฑ ุงููุณุชุฎุฏูุฉ: {len(response.source_nodes)}")
                </div>
                
                <h3>๐ฏ ูุชุงุฆุฌ ุงููุซุงู:</h3>
                <ul>
                    <li><strong>ุถุบุท ุฐูู:</strong> ุชู ุชูููู ุงููุญุชูู ุจูุณุจุฉ 60-80%</li>
                    <li><strong>ุฌูุฏุฉ ูุญุงูุธุฉ:</strong> ุงูุฅุฌุงุจุฉ ุฏูููุฉ ููููุฏุฉ</li>
                    <li><strong>ุณุฑุนุฉ ุฃูุจุฑ:</strong> ููุช ุงููุนุงูุฌุฉ ุฃูู ุจูุซูุฑ</li>
                    <li><strong>ุชูููุฉ ุฃูู:</strong> ุงุณุชููุงู tokens ุฃูู</li>
                </ul>
            </div>
        </div>

        <div class="card">
            <h2>๐ง ุฃูุซูุฉ ูุชูุฏูุฉ ููุงุณุชุฎุฏุงู</h2>
            <div class="practical-box">
                <h3><span class="step-number">6</span>ุถุจุท ุฏููู ุญุณุจ ููุน ุงููุญุชูู:</h3>
                
                <h4>๐ ูููุญุชูู ุงูุฃูุงุฏููู:</h4>
                <div class="code-box">
# ุฅุนุฏุงุฏ ุฎุงุต ุจุงููุญุชูู ุงูุฃูุงุฏููู
academic_postprocessor = LongLLMLinguaPostprocessor(
    instruction_str="ุงุญุชูุธ ุจุงููุตุทูุญุงุช ุงูุนูููุฉ ูุงูุชูุงุตูู ุงููููุฉ",
    target_token=800,              # ูุต ุฃุทูู ูููุญุชูู ุงูุฃูุงุฏููู
    rank_method="longllmlingua",
    additional_compress=0.05,      # ุถุบุท ุฃูู ูููุญุงูุธุฉ ุนูู ุงูุชูุงุตูู
    condition_compare=True
)
                </div>
                
                <h4>๐ฐ ููุฃุฎุจุงุฑ ูุงูุชูุงุฑูุฑ:</h4>
                <div class="code-box">
# ุฅุนุฏุงุฏ ุฎุงุต ุจุงูุฃุฎุจุงุฑ
news_postprocessor = LongLLMLinguaPostprocessor(
    instruction_str="ุฑูุฒ ุนูู ุงูุฃุญุฏุงุซ ูุงูุชูุงุฑูุฎ ูุงูุฃุฑูุงู ุงููููุฉ",
    target_token=400,              # ูุต ูุฎุชุตุฑ ููุฃุฎุจุงุฑ
    rank_method="longllmlingua",
    additional_compress=0.15,      # ุถุบุท ุฃูุจุฑ ููุงุฎุชุตุงุฑ
    reorder_context="sort"
)
                </div>
                
                <h4>๐ผ ูููุญุชูู ุงูุชุฌุงุฑู:</h4>
                <div class="code-box">
# ุฅุนุฏุงุฏ ุฎุงุต ุจุงูุฃุนูุงู
business_postprocessor = LongLLMLinguaPostprocessor(
    instruction_str="ุฑูุฒ ุนูู ุงููุนูููุงุช ุงููุงููุฉ ูุงููุฑุงุฑุงุช ุงูุงุณุชุฑุงุชูุฌูุฉ",
    target_token=600,
    rank_method="longllmlingua",
    additional_compress=0.08,
    condition_compare=True,
    context_budget="+50"
)
                </div>
                
                <h3><span class="step-number">7</span>ุงุณุชุฎุฏุงู ูุชุนุฏุฏ ุงููุฑุงุญู:</h3>
                <div class="code-box">
# ุฅูุดุงุก pipeline ูุชุนุฏุฏ ุงููุฑุงุญู
from llama_index.core.postprocessor import SentenceTransformerRerank

# ุงููุฑุญูุฉ ุงูุฃููู: ุฅุนุงุฏุฉ ุชุฑุชูุจ
reranker = SentenceTransformerRerank(
    model="cross-encoder/ms-marco-MiniLM-L-6-v2",
    top_n=20
)

# ุงููุฑุญูุฉ ุงูุซุงููุฉ: ุถุบุท
compressor = LongLLMLinguaPostprocessor(
    target_token=300,
    rank_method="longllmlingua"
)

# ุงูุงุณุชุฎุฏุงู ุงููุชุณูุณู
query_engine = index.as_query_engine(
    node_postprocessors=[reranker, compressor],  # ูุฑุญูุชุงู ูุชุชุงููุชุงู
    similarity_top_k=50
)
                </div>
            </div>
        </div>

        <div class="card">
            <h2>๐ก ูุตุงุฆุญ ูุญูู ูุชูุฏูุฉ</h2>
            <div class="tips-box">
                <h3>๐ฏ ูุตุงุฆุญ ููุฃุฏุงุก ุงูุฃูุซู:</h3>
                
                <h4>1. ุงุฎุชูุงุฑ target_token ุงูููุงุณุจ:</h4>
                <ul>
                    <li><strong>ููุฅุฌุงุจุงุช ุงูุณุฑูุนุฉ:</strong> 200-400 token</li>
                    <li><strong>ููุชุญููู ุงููุชูุณุท:</strong> 500-800 token</li>
                    <li><strong>ููุดุฑุญ ุงูููุตู:</strong> 800-1200 token</li>
                    <li><strong>ูููุญุชูู ุงูุดุงูู:</strong> 1200+ token</li>
                </ul>
                
                <h4>2. ุถุจุท additional_compress:</h4>
                <ul>
                    <li><strong>ูุญุชูู ููู:</strong> 0.05-0.1 (ุถุบุท ูููู)</li>
                    <li><strong>ูุญุชูู ุนุงู:</strong> 0.1-0.2 (ุถุบุท ูุชูุณุท)</li>
                    <li><strong>ูุญุชูู ููุฑุฑ:</strong> 0.2-0.3 (ุถุบุท ุนุงูู)</li>
                </ul>
                
                <h4>3. ุงุณุชุฎุฏุงู instruction_str ุจุฐูุงุก:</h4>
                <div class="code-box">
# ุฃูุซูุฉ ุนูู ุชุนูููุงุช ูุนุงูุฉ
instructions = {
    "technical": "ุงุญุชูุธ ุจุงููุตุทูุญุงุช ุงูุชูููุฉ ูุงูุฃุฑูุงู ูุงูุชูุงุฑูุฎ",
    "summary": "ุฑูุฒ ุนูู ุงูููุงุท ุงูุฑุฆูุณูุฉ ูุงูุงุณุชูุชุงุฌุงุช",
    "detailed": "ุญุงูุธ ุนูู ุงูุชูุงุตูู ุงููููุฉ ูุงูุฃูุซูุฉ ุงูุชูุถูุญูุฉ",
    "comparison": "ุฑูุฒ ุนูู ููุงุท ุงูููุงุฑูุฉ ูุงูุงุฎุชูุงูุงุช"
}
                </div>
                
                <h4>4. ูุฑุงูุจุฉ ุงูุฃุฏุงุก:</h4>
                <div class="code-box">
import time

def monitor_compression(query_engine, question):
    start_time = time.time()
    response = query_engine.query(question)
    end_time = time.time()
    
    print(f"โฑ๏ธ ููุช ุงููุนุงูุฌุฉ: {end_time - start_time:.2f} ุซุงููุฉ")
    print(f"๐ ุทูู ุงูุฅุฌุงุจุฉ: {len(response.response)} ุญุฑู")
    print(f"๐ ุนุฏุฏ ุงููุตุงุฏุฑ: {len(response.source_nodes)}")
    
    return response
                </div>
                
                <h3>โ๏ธ ุฃุฎุทุงุก ุดุงุฆุนุฉ ูุญููููุง:</h3>
                <ul>
                    <li><strong>target_token ุตุบูุฑ ุฌุฏุงู:</strong> ุฒูุฏ ุงูุฑูู ุชุฏุฑูุฌูุงู</li>
                    <li><strong>ุถุบุท ุฒุงุฆุฏ:</strong> ููู additional_compress</li>
                    <li><strong>ููุฏุงู ูุนูููุงุช ูููุฉ:</strong> ุงุถุจุท instruction_str</li>
                    <li><strong>ุจุทุก ูู ุงููุนุงูุฌุฉ:</strong> ุงุณุชุฎุฏู GPU ุฃู ููู ุงูุจูุงูุงุช</li>
                </ul>
            </div>
        </div>

        <div class="card">
            <h2>๐งช ุงุฎุชุจุงุฑ ูุชูููู ุงููุชุงุฆุฌ</h2>
            <div class="example-box">
                <h3><span class="step-number">8</span>ููุงุณ ูุนุงููุฉ ุงูุถุบุท:</h3>
                <div class="code-box">
def evaluate_compression(original_query_engine, compressed_query_engine, test_questions):
    results = []
    
    for question in test_questions:
        # ุงูุทุฑููุฉ ุงูุชูููุฏูุฉ
        start = time.time()
        original_response = original_query_engine.query(question)
        original_time = time.time() - start
        
        # ุงูุทุฑููุฉ ุงููุถุบูุทุฉ
        start = time.time()
        compressed_response = compressed_query_engine.query(question)
        compressed_time = time.time() - start
        
        # ููุงุฑูุฉ ุงููุชุงุฆุฌ
        result = {
            'question': question,
            'original_time': original_time,
            'compressed_time': compressed_time,
            'time_saved': original_time - compressed_time,
            'compression_ratio': compressed_time / original_time,
            'original_length': len(original_response.response),
            'compressed_length': len(compressed_response.response)
        }
        results.append(result)
        
        print(f"๐ ุงูุณุคุงู: {question[:50]}...")
        print(f"   โฑ๏ธ ุชูููุฑ ุงูููุช: {result['time_saved']:.2f} ุซุงููุฉ")
        print(f"   ๐ ูุณุจุฉ ุงูุถุบุท: {result['compression_ratio']:.2%}")
        print()
    
    return results

# ุชุทุจูู ุงูุชูููู
test_questions = [
    "ูุง ูู ููุงุฆุฏ ุงูุฐูุงุก ุงูุงุตุทูุงุนูุ",
    "ููู ูุนูู ุงููุธุงูุ",
    "ูุง ูู ุงูุชุญุฏูุงุช ุงููุณุชูุจููุฉุ"
]

evaluation_results = evaluate_compression(
    original_query_engine, 
    compressed_query_engine, 
    test_questions
)
                </div>
                
                <h3>๐ ุชุญููู ุงููุชุงุฆุฌ ุงููุชููุนุฉ:</h3>
                <ul>
                    <li><strong>ุชูููุฑ ุงูููุช:</strong> 40-70% ุฃุณุฑุน</li>
                    <li><strong>ุชูููุฑ ุงูุชูููุฉ:</strong> 50-80% ุฃูู ูู tokens</li>
                    <li><strong>ุฌูุฏุฉ ุงูุฅุฌุงุจุงุช:</strong> 85-95% ูู ุงูุฌูุฏุฉ ุงูุฃุตููุฉ</li>
                    <li><strong>ููุงุกุฉ ุงูุฐุงูุฑุฉ:</strong> ุงุณุชููุงู ุฃูู ุจูุซูุฑ</li>
                </ul>
            </div>
        </div>

        <div class="footer">
            <p>๐ป ุงูุชุทุจูู ุงูุนููู ูู ุฃูุถู ุทุฑููุฉ ูุฅุชูุงู LongLLMLinguaPostprocessor!</p>
        </div>
    </div>
</body>
</html>