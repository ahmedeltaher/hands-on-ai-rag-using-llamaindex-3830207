<div dir="rtl">

# ๐งฉ Node Postprocessors (ููุนุงููุฌุงุช ุงูุนูุฏ) โ ุจุงูุนุฑุจู ุงููุตุฑู

**Postprocessor** ูู ุฃุฏุงุฉ ุจุชุทุจูู ูุนุงูุฌุฉ ุฃู ููุชุฑุฉ ุฅุถุงููุฉ ุนูู ููุณุชุฉ ูู **nodes** ุฑุงุฌุนุฉ ูู ุงุณุชุนูุงูุ ูุจุชุฑุฌูุน ุงููุชุงุฆุฌ ุงูููุงุฆูุฉ.  
ูู LlamaIndexุ ุงูู **node postprocessors** ูู ููุฏูููุงุช ุจุชุงุฎุฏ ูุฌููุนุฉ ูู ุงูู nodesุ ุชุนูู ุนูููุง **ุชุญูููุงุช ุฃู ููุชุฑุฉ**ุ ูุชุฑุฌูุนูุง.

ุบุงูุจูุง ุจูุณุชุฎุฏู ุงูู postprocessors ุฌูุง **Query Engine** ุจุนุฏ ุฎุทูุฉ **ุงุณุชุฑุฌุงุน ุงูู nodes** (retrieval) ููุจู ุฎุทูุฉ **ุชุฌููุน/ุชูููู ุงูุฑุฏ** (response synthesis).

ููุง ููุดุฑุญ ุงูุจูุณุช ุจุฑูุณูุณูุฑุฒ ุฏูู (ูุณูุฑุณ ููุฏ ููููู ููุฌูุฏ ูู ููุง):
- ๐งพ ุงูุฑุงุจุท: [Node Postprocessors โ ุงููุตุฏุฑ](https://github.com/run-llama/llama_index/blob/main/llama-index-core/llama_index/core/postprocessor/node.py#L64C1-L140C17)

ุงููู ููุบุทูู:

- ๐ฅ `SimilarityPostprocessor`  
- ๐ `KeywordNodePostprocessor`  
- ๐ `MetadataReplacementPostProcessor`  
- โธ `LongContextReorder`  
- ๐ `SentenceEmbeddingOptimizer`  

> ูู ุฏูู instances ูู ุงูููุงุณ ุงูุฃุณุงุณู [`BaseNodePostProcessor`](https://github.com/run-llama/llama_index/blob/main/llama-index-core/llama_index/core/postprocessor/types.py)  
> ูุนูู ูููู **ููุณ ูุงุฌูุฉ ุงูุงุณุชุฎุฏุงู** ูููุณ ุงูู pattern ุงูุนุงู.

---

## โท Pattern ุงูุงุณุชุฎุฏุงู

ุงูู **node postprocessors** ุจุชุชุทุจู ุฌูุง ุงูู **query engine** ุนูู ุงูู nodes ุงููู ุฑุฌุนุช ูู ุงูู retrieverุ **ูุจู** ุฎุทูุฉ ุชูููู ุงูุฑุฏ.

### ูุซุงู ุจุณูุท:

```python
from llama_index.core import VectorStoreIndex, SimpleDirectoryReader
from llama_index.core.postprocessor import YourPostProcessOfChoice

... # ุฎุทูุงุช ูุจู ูุฏู: ุชุนุฑูู ุงู index

your_post_processor = YourPostProcessOfChoice(WhateverArgumentsYouNeedToPass)

query_engine = index.as_query_engine(
    ..., # ุจุงูู ุฅุนุฏุงุฏุงุช ุงู query engine
    node_postprocessors = your_post_processor
)

# ูุงุณุชุนูุงู ูุงุญุฏ
response = query_engine.query("your query")

# ุฃู ุชูุฏุฑ ุชุทุจู ุงู pipeline ุนูู ูู ุงูุฏุงุชุง
```

> ุจุนุฏ ูุง ุดูุช ุงูุจุงุชุฑู ุฏู ูุฐุง ูุฑุฉุ ุงูููุฑูุถ ุจููุช ุนุงุฑู ุชุทุจููู ๐  
> ุชุญุช ูููุตู ูู ุจูุณุช ุจุฑูุณูุณูุฑ ูุฅุฒุงู ุชinstantiat(e) โ ูุงูุช ุทุจููู ุนูู ุงูู query engine ุนูุฏู ุจุฑุงุญุชู.

---

## ๐ฅ [`SimilarityPostprocessor`](https://github.com/run-llama/llama_index/blob/f116d75557d6867ed2cc61811a1c2f0b0c4d4ddb/llama-index-core/llama_index/core/postprocessor/node.py#L64C1-L140C17)

ุฏู ุงุณูู ุนูู ูุณููุงู:  
ุจูููุชุฑ ููุณุชุฉ ุงูู nodes ุจูุงุกู ุนูู **ุฏุฑุฌุงุช ุงูุชุดุงุจู** (similarity scores).  
ุฅูุช ุจุชุญุฏุฏ ูููุฉ **`similarity_cutoff`** ูุนุชุจุฉ ููุชุฑุฉ: ุฃู node ุฏุฑุฌุชูุง **ุฃุนูู ูู ุงูุนุชุจุฉ** ุจุชุชุถููู ูู ุงููุชูุฌุฉ (ููู ูุง ููุด cutoffุ ููู ุจูุชุนุฏูู โ ูุฏู ุบุงูุจูุง ูุงููุด ูุงุฒูุฉ ๐).

### ุงูุจุฑุงููุชุฑุงุช ุงููููุฉ
- `similarity_cutoff`: ุฃูู ุฏุฑุฌุฉ ุชุดุงุจู ูุณููุญ ุจููุง ุนุดุงู ุงูู node ุชุชุถููู ูู ุงูุฎุฑุฌ.  
  ูู ูุง ุญุทูุชูุงุดุ ูุด ููุชู ุฃู ููุชุฑุฉ (ูุฏู ุจูุจุทู ูุงูุฏุฉ ุงูู postprocessor ุฃุตูุงู).

### ุงููู ุจูุญุตู ุฌููู (Under the hood)
1. ุจูุชุดูู ุฅุฐุง ูุงู `similarity_cutoff` ูุชุถุจูุทุฉ (ูุด `None`).  
2. ุจููู ุนูู ูู node ูู ุงูููุณุชุฉ.  
3. ููู node:
   - ูู ุฏุฑุฌุฉ ุงูุชุดุงุจู `None` ุฃู **ุฃูู** ูู ุงูุนุชุจุฉ โ ุจุชุชุณุชุจุนุฏ.  
   - ูู **ุฃุนูู** ูู ุงูุนุชุจุฉ **ุฃู** ูุงูููุด ุนุชุจุฉ ุฃุตูุงู โ ุจุชุชุถููู ูู ุงููุชูุฌุฉ.  
4. ุจูุฑุฌุน ููุณุชุฉ ูู `NodeWithScore` ุจุนุฏ ุงูููุชุฑุฉ โ ุฏูู ุงููู ุนูุฏููุง ุงูุนุชุจุฉ.

---

> ุจุงูู ุงูู postprocessors ุงููุฐููุฑูู ููู ุจูุชุจุนูุง ููุณ **Pattern ุงูุงุณุชุฎุฏุงู**ุ
> ูุจุชูุฏุฑ ุชุฏูุฌูู ุญุณุจ ุงุญุชูุงุฌู ุจูู ุงูุงุณุชุฑุฌุงุน ูุชูููู ุงูุฑุฏ ุนุดุงู ุชุญุณูู ุงูุฌูุฏุฉ ูุชูููู ุงูุถูุถุงุก.

---

# ๐ [`KeywordNodePostprocessor`](https://github.com/run-llama/llama_index/blob/f116d75557d6867ed2cc61811a1c2f0b0c4d4ddb/llama-index-core/llama_index/core/postprocessor/node.py#L20)

ุงูู **KeywordNodePostprocessor** ุจุจุณุงุทุฉ ุจูุณุชุฎุฏู **ูููุงุช ููุชุงุญูุฉ** ุนุดุงู ูููุชุฑ ุงูู nodes.  
ุงูููุฑุฉ ุฅูู ุจูุดูู ูู node ููุดูู ูู ูููุง ูููุงุช ูุนููุฉ ูุงุฒู ุชููู ููุฌูุฏุฉุ ุฃู ูููุงุช ุชุงููุฉ ูุงุฒู **ูุง ุชูููุด ููุฌูุฏุฉ**.  
ุจุณ ุงูู nodes ุงููู ุจุชุณุชููู ุงูุดุฑูุท ุฏู ูู ุงููู ุจุชุฏุฎู ูู ุงููุชูุฌุฉ ุงูููุงุฆูุฉ โ

---

## โ๏ธ ุงูุจุฑุงููุชุฑุงุช ุงููู ูุญุชุงุฌ ุชุนุฑููุง

- **`required_keywords`** โ  
  ููุณุชุฉ ุจุงููููุงุช ุงููู ูุงุฒู ุชููู ููุฌูุฏุฉ ูู ูุญุชูู ุงูู node ุนุดุงู ุชุชุถููู ูู ุงููุชูุฌุฉ.  
  ูู ูุง ุญุฏุฏุชูุงุดุ ุงูุดุฑุท ุฏู ูุด ุจูุชุทุจูู.

- **`exclude_keywords`** โ  
  ููุณุชุฉ ุจุงููููุงุช ุงููู **ููููุนุด** ุชููู ููุฌูุฏุฉ ูู ูุญุชูู ุงูู node.  
  ูู ุงููููุฉ ููุฌูุฏุฉุ ุงูู node ุฏู ุจุชุชุณุชุจุนุฏ ุนูู ุทูู ๐ซ  
  ููู ูุง ุญุฏุฏุชูุงุดุ ุงูุดุฑุท ุฏู ููุงู ูุด ุจูุชุทุจูู.

- **`lang`** โ  
  ูุบุฉ ุงููุต ุงููู ุฌูู ุงูู nodes (ุงูุงูุชุฑุงุถู `"en"` ูุนูู ุฅูุฌููุฒู).

---

## ๐ ุงููู ุจูุญุตู ุฌูู ุงูููุฏ (Under the hood)

1. ุงูุฏุงูุฉ ุจุชูุฑู ุนูู ูู ูุงุฆู ูู ููุน `NodeWithScore` ูู ุงูููุณุชุฉ.  
2. ููู nodeุ ุจุชุฌูุจ ูุญุชูุงูุง ุงููุตู ูุชุฌููุฒู ุจุงุณุชุฎุฏุงู **ูููุฐุฌ Spacy** ุญุณุจ ุงููุบุฉ.  
3. ูู ููู `required_keywords`:
   - ู ุงูู node **ูุงูููุงุด** ุฃู ูู ุงููููุงุช ุงููุทููุจุฉ โ ุจุชุชุณุชุจุนุฏ.  
4. ูู ููู `exclude_keywords`:
   - ู ุงูู node **ูููุง** ุฃู ูู ุงููููุงุช ุงูููููุนุฉ โ ุจุชุชุณุชุจุนุฏ ุจุฑุถู.  
5. ูู ุงูู node ุนูุฏูุช ุงูุดุฑุทูู (ุฃู ูุงููุด ูููุงุช ูุญุฏุฏุฉ ุฃุตููุง) โ ุจุชุชุถููู ูู ุงููุชูุฌุฉ.  
6. ูู ุงูุขุฎุฑุ ุจุชุฑุฌุน ููุณุชุฉ ูููุง ูู ุงูู nodes ุงููู ูุฌุญุช ูู ุงูููุชุฑุฉ ุญุณุจ ุงูุดุฑูุท.

---

## โ ุงูุฎูุงุตุฉ

ุงูู **KeywordNodePostprocessor** ูููุฏ ุฌุฏูุง ููุง ุชุญุจ ุชุชุญููู ูู ููุน ุงููุญุชูู ุงููู ุงูููุฏูู ูุดุชุบู ุนููู:  
ุชูุฏุฑ ุชุถูู ุฅู ุงูุฑุฏ ูุฌู ูู **ูุตูุต ูููุง ูููุงุช ูุนููุฉ**ุ  
ูุชุจุนุฏ ุนู ุฃู ูุตุงุฏุฑ ูููุง **ูููุงุช ูุด ูุฑุบูุจุฉ** โจ  


---

# ๐ [`MetadataReplacementPostProcessor`](https://github.com/run-llama/llama_index/blob/main/llama-index-core/llama_index/core/postprocessor/metadata_replacement.py)

ุงูู **MetadataReplacementPostProcessor** ููุฑุชู ุจุณูุทุฉ ุฌุฏูุง ูููู ูููุฏ ุฌุฏูุง ๐  
ูู ุจูุณูุญูู ุฅูู **ุชุจุฏูู ูุญุชูู ูู node** ูู ุงูููุณุชุฉ ุจูููุฉ ูุนููุฉ ูู **metadata** ุจุฏู ุงููุต ุงูุฃุตูู.  
ูุนูู ุจุฏู ูุง ูุนุชูุฏ ุนูู ุงููุต ููุณูุ ููุฏุฑ ูุนุชูุฏ ุนูู **ูููุฉ ููุฌูุฏุฉ ูู ุงูููุชุงุฏุงุชุง** (ุฒู ุนููุงูุ ุฑููุ ุฃู ูุณู).  

ูู ุงูููุชุงุญ ุงููู ุจุชุญุฏุฏู **ูุด ููุฌูุฏ** ูู ุงูููุชุงุฏุงุชุงุ ุงููุญุชูู ุงูุฃุตูู ููู node **ุจููุถู ุฒู ูุง ูู**.  
ุงูููุฒุฉ ุฏู ุจุชููู ูููุฏุฉ ุฌุฏูุง ููุง ุชุณุชุฎุฏููุง ูุน `SentenceWindowNodeParser` ๐  

---

## โ๏ธ ุงูุจุฑุงููุชุฑุงุช ุงููู ูุญุชุงุฌ ุชุนุฑููุง

- **`target_metadata_key`** โ  
  ุงุณู ููุชุงุญ ุงูููุชุงุฏุงุชุง ุงููู ูููุชู ูุชุณุชุจุฏู ูุญุชูู ุงูู node.  
  ูุซููุง: ูู ุนูุฏู metadata ูููุง `{ "title": "Chapter 1" }`  
  ูุชุณุชุฎุฏู ุงูููุชุงุญ `"title"`ุ ูุจูู ูุญุชูู ุงูู node ููุจูู "Chapter 1".  

---

## ๐ ุงููู ุจูุญุตู ุฌูู ุงูููุฏ (Under the hood)

1. ุงูููุฏ ุจููุฑู ุนูู ูู ูุงุฆู ูู ููุน `NodeWithScore` ูู ุงูููุณุชุฉ.  
2. ููู node:
   - ุจูุญุงูู ูุฌูุจ ุงููููุฉ ุงูุฎุงุตุฉ ุจู `target_metadata_key` ูู ุงูููุชุงุฏุงุชุง ุจุชุงุนุชูุง.  
   - ูู ุงูููุชุงุญ ููุฌูุฏ โ ุจูุจุฏูู ุงููุญุชูู ุงูุฃุตูู ุจุงููููุฉ ุฏู.  
   - ูู ุงูููุชุงุญ **ูุด ููุฌูุฏ** โ ุงููุญุชูู ุงูุฃุตูู **ุจููุถู ุฒู ูุง ูู**.  
3. ูู ุงูุขุฎุฑ ุจูุฑุฌุน ููุณุชุฉ ุฌุฏูุฏุฉ ูู `NodeWithScore` ุจุนุฏ ุงูุชุนุฏููุงุช.

---

## โ ุงูุฎูุงุตุฉ

ุงูู **MetadataReplacementPostProcessor** ุฃุฏุงุฉ ุนุจูุฑูุฉ ูู ุนุงูุฒ ุชุฎููู ุงูููุฏูู ูุดุชุบู ุนูู **ููู ูุนููุฉ ูู ุงูููุชุงุฏุงุชุง** ุจุฏู ุงููุตูุต ุงููุงููุฉ.  
ูููุฏุฉ ุฌุฏูุง ููุง ุชููู ุนุงูุฒ **ุชูุฎูุต ุฃู ุชุฑุชูุจ** ูุนูููุงุช ูุจููุฉ ุนูู ุจูุงูุงุช ูุตููุฉ ูุนููุฉ ๐ฏ  
---

# โธ [`LongContextReorder`](https://github.com/run-llama/llama_index/blob/236fae0e8a30d6f8f9ac31777868d1d868933d79/llama-index-core/llama_index/core/postprocessor/node.py#L358)

ุจุญุณุจ [ุฏุฑุงุณุฉ](https://arxiv.org/abs/2307.03172)ุ ุงูููุงุฐุฌ ุงููุบููุฉ (LLMs) ุจุชูุงุฌู ุตุนูุจุฉ ูู **ุงููุตูู ูููุนูููุงุช ุงููููุฉ ุงููู ุจุชููู ูู ูุต ุงูุณูุงู ุงูุทููู**.  
ุงูุฏุฑุงุณุฉ ุฏู ูุงุญุธุช ุฅู ุงูุฃุฏุงุก ุจูููู **ุฃูุถู ููุง ุงููุนูููุงุช ุงููููุฉ ุชููู ูู ุฃูู ุฃู ุขุฎุฑ ุงูู context**ุ  
ุญุชู ุงูููุงุฐุฌ ุงููู ูุตููุฉ ุชุชุนุงูู ูุน ุณูุงูุงุช ุทูููุฉุ ุฃุฏุงุฆูุง ุจููุฒู ูู ูุง ุงููุต ูุทูู ุฃูุชุฑ. ๐  

ุนุดุงู ูุฏูุ ุชู ุงุจุชูุงุฑ ููุงุณ ุงุณูู **`LongContextReorder`**ุ  
ูุธููุชู ุฅูู **ูุนูุฏ ุชุฑุชูุจ ุงูู nodes ุญุณุจ ุฏุฑุฌุงุช ุงูุตูุฉ (relevance scores)**  
ุจุทุฑููุฉ ุฐููุฉ ุชุฎูู ุงูููุฏูู ููุฏุฑ ููุตู ูููุนูููุงุช ุงููููุฉ ุจุณูููุฉ ุญุชู ูู ุงูู context ุทููู ุฌุฏูุง.  

ูู ุจูุญุท ุงูู nodes ุงููู ุฏุฑุฌุงุชูุง ุฃุนูู **ุจุงูุชุจุงุฏู ูู ุฃูู ูุขุฎุฑ ุงูููุณุชุฉ**ุ  
ุนุดุงู ุงููุนูููุงุช ุงููููุฉ ุชุจูู ูู ุงูุฃูุงูู ุงููู ุงูููุฏูู ุจููุฑุฃูุง ูููุณ โ ุงูุจุฏุงูุฉ ูุงูููุงูุฉ.

---

## โ๏ธ ุงูุจุฑุงููุชุฑุงุช ุงููู ูุญุชุงุฌ ุชุนุฑููุง

ููุง ุญุงุฌุฉ ๐  
ุงูููุงุณ ุฏู ูุด ูุญุชุงุฌ ููู ุฃู ุจุฑุงููุชุฑุงุชุ ุจูุดุชุบู ููุญุฏู.

---

## ๐ ุงููู ุจูุญุตู ุฌูู ุงูููุฏ (Under the hood)

1. ุงูููุฏ ุจูุฑุชูุจ ููุณุชุฉ ุงูู `nodes` ุญุณุจ **ุฏุฑุฌุฉ ุงูุตูุฉ (relevance score)** ุชูุงุฒูููุง โ ูุนูู ุงูุฃุนูู ูู ุงูุฃูู.  
   ูู ุฃู node ูุงููุงุด scoreุ ุจูุนุชุจุฑูุง ุตูุฑ.  

2. ุจุนุฏ ูุฏูุ ุจููู ุนูู ุงูููุณุชุฉ ุงููู ุงุชููุชุฑุช.  

3. ููู nodeุ ุจูุดูู ุนูู ุฑูููุง (ุงูู index):  
   - ูู **ุงูุฑูู ุฒูุฌู (0ุ 2ุ 4...)** โ ุจูุญุทูุง ูู **ุฃูู ุงูููุณุชุฉ** ุจุงุณุชุฎุฏุงู `insert(0, node)`.  
   - ูู **ุงูุฑูู ูุฑุฏู (1ุ 3ุ 5...)** โ ุจูุญุทูุง ูู **ุขุฎุฑ ุงูููุณุชุฉ** ุจุงุณุชุฎุฏุงู `append(node)`.  

4. ูู ุงูุขุฎุฑ ุจูุฑุฌุน ููุณุชุฉ ุฌุฏูุฏุฉ ุงุณููุง `reordered_nodes`ุ  
   ูุฏู ูููุง ูู ุงูู nodes ุจุงูุชุฑุชูุจ ุงูุฌุฏูุฏ ุงููู ุจูุณุงุนุฏ ุงูููุฏูู ููุฑุฃ ุงููุนูููุงุช ุงูุฃูู ูู ุงูุฃูู ูุงูุขุฎุฑ.

---

## โ ุงูุฎูุงุตุฉ

ุงูู **LongContextReorder** ุจูุญู ูุดููุฉ "ุงููุนูููุงุช ุงููู ุจุชุถูุน ูู ุงููุต" ๐ง  
ุนู ุทุฑูู ุฅุนุงุฏุฉ ุชุฑุชูุจ ุงูู nodes ุจุทุฑููุฉ ุฐููุฉุ ุจูุฎูู ุงูููุฏูู ููุฏุฑ ูุฑูุฒ ุนูู ุฃูู ุงูููุงุท ุญุชู ูู ุงููุตูุต ุงูุทูููุฉ ุฌุฏูุง.  

ูุฏู ุจูุญุณูู ุฏูุฉ ุงููุชุงุฆุฌ ุฎุตูุตูุง ูู ุญุงูุงุช ุงูู **long-context retrieval** ๐ช  

---


# ๐ [`SentenceEmbeddingOptimizer`](https://github.com/run-llama/llama_index/blob/main/llama-index-core/llama_index/core/postprocessor/optimizer.py)

ุงูู **SentenceEmbeddingOptimizer** ูู ููุน ูู ุงูู **node postprocessor** ุจูุญุณูู ุงููุตูุต ุฌูู ุงูู nodes ุจูุงุกู ุนูู ูุฏู ุงุฑุชุจุงุทูุง ุจุงูุณุคุงู ุฃู ุงูุงุณุชุนูุงู ุงููู ุจุชุณุฃูู ๐.  

ุงูููุฑุฉ ุจุจุณุงุทุฉ ุฅูู ุจูุณุชุฎุฏู **ุฏุฑุฌุงุช ุชุดุงุจู ูุจููุฉ ุนูู ุงูู embeddings**  
ุนุดุงู ูุฎุชุงุฑ ุงูุฌููู ุงููู ูููุง ุนูุงูุฉ ูููุฉ ุจุงูุณุคุงูุ ูููููู ุญุฌู ุงููุต.  

ูุนูู ุจูุดูู ุงูุฌูู ุงููู ูุงููุงุด ุนูุงูุฉ ุจุงูุณุคุงูุ  
ูุจูุฎูู ุงูุฌูู ุงููููุฉ ุจุณ โ ูุฏู ุจูุณุงุนุฏ ุงูููุฏูู ูุฑููุฒ ุนูู ุงููุถููู ุจุฏู ุงูุญุดู ๐ช  

ูููู ุชุฎุชุงุฑ ุงูุฌูู ุฏู ูุง ุฅูุง ุญุณุจ **ูุณุจุฉ ูุฆููุฉ (percentile cutoff)** ุฃู **ุนุชุจุฉ ุฑูููุฉ (threshold cutoff)**.

---

## โ๏ธ ุงูุจุฑุงููุชุฑุงุช ุงููู ูุญุชุงุฌ ุชุนุฑููุง

ูู ุงูุจุฑุงููุชุฑุงุช ุฏู **ุงุฎุชูุงุฑูุฉ**ุ ูุชูุฏุฑ ุชุฏูุฌ ุฃูุชุฑ ูู ูุงุญุฏุฉ ูุน ุจุนุถ ุญุณุจ ุงุญุชูุงุฌู ๐

- **`embed_model`** โ  
  ุงูููุฏูู ุงููู ููุณุชุฎุฏูู ูู ุชูููุฏ ุงูู embeddings ููุฌูู.  
  ุงูุงูุชุฑุงุถู ูู `OpenAIEmbedding`.

- **`percentile_cutoff`** โ  
  ุงููุณุจุฉ ุงููู ูุชุชุฎุชุงุฑ ุจููุง ุงูุฌูู ุงูุฃูุซุฑ ุงุฑุชุจุงุทูุง.  
  ูุซููุง ูู ุญุทููุชูุง `0.5`ุ ูุชุชุงุฎุฏ **ุฃุนูู 50ูช ูู ุงูุฌูู** ุงููู ุฏุฑุฌุงุช ุชุดุงุจููุง ุฃุนูู.  
  ุฏู ูููุฏุฉ ูู ุนุงูุฒ ุชุฎุชุงุฑ ูุณุจุฉ ูุนููุฉ ูู ุงูุฌูู ุงููููุฉ ููุท.

- **`threshold_cutoff`** โ  
  ุงูุนุชุจุฉ ุงููู ุจูููุณ ุจููุง ุงูุฌูู.  
  ูุซููุง ูู ุญุทููุชูุง `0.7`ุ ูุจูู ุจุณ ุงูุฌูู ุงููู ุฏุฑุฌุชูุง **0.7 ุฃู ุฃูุชุฑ** ูู ุงููู ูุชุชุงุฎุฏ.  
  ูููู ููุงู ุชุฏูุฌูุง ูุน `percentile_cutoff` ูู ุญุงุจุจ.

- **`tokenizer_fn`** โ  
  ุงููุงููุดู ุงููู ุจููุณูู ุงููุต ุฅูู ุฌูู.  
  ุงูุงูุชุฑุงุถู ูู ููุณูู ุงูุฌูู ุจุชุงุน **NLTK** (ุงูุฅูุฌููุฒู).

- **`context_before`** โ  
  ุนุฏุฏ ุงูุฌูู ุงููู ุนุงูุฒ ุชุถูููุง **ูุจู ุงูุฌูู ุงููุฎุชุงุฑุฉ** ุนุดุงู ุชูููุฑ ุณูุงู ุฅุถุงูู.

- **`context_after`** โ  
  ุนุฏุฏ ุงูุฌูู ุงููู ุนุงูุฒ ุชุถูููุง **ุจุนุฏ ุงูุฌูู ุงููุฎุชุงุฑุฉ** ุนุดุงู ุชุญุงูุธ ุนูู ุชุฑุงุจุท ุงููุต.

---

## ๐ ุงููู ุจูุญุตู ุฌููู ุงูููุฏ (Under the hood)

ููู node:

1. ุจูุฌูุจ ุงููุต ุงูุฃุตูู ุงููู ูููุง.  
2. ุจููุณููู ุฅูู ุฌูู ุจุงุณุชุฎุฏุงู ุงูู tokenizer.  
3. ุจููููุฏ embeddings ููุฌูู ูููุงู ููุณุคุงู ููุณู.  
4. ุจูุญุณุจ ุฏุฑุฌุฉ ุงูุชุดุงุจู ุจูู ูู ุฌููุฉ ูุงูุณุคุงู.  
5. ุจูุฎุชุงุฑ ุงูุฌูู ุงูุฃุนูู ุชุดุงุจููุง ุญุณุจ ุงูู `percentile_cutoff` ุฃู `threshold_cutoff`.  
6. ุจูุถูู ุงูุฌูู ุงููู ูุจู ูุจุนุฏ ุงูุฌูู ุงููุฎุชุงุฑุฉ ูู ููู ุฅุนุฏุงุฏุงุช ููุณูุงู.  
7. ุจูุฌูุน ุงูุฌูู ุฏู ูููุง ูู ูุต ุฌุฏูุฏ ูุญุณูู.  
8. ุจูุญุฏูุซ ูุญุชูู ุงูู node ุจุงููุต ุงูุฌุฏูุฏ ุฏู โจ

---

## โ ุงูุฎูุงุตุฉ

ุงูู **SentenceEmbeddingOptimizer** ุจูุณุงุนุฏู ุชูููู ุงูููุงู ุงูุฒุงูุฏ ูุชุฎูู ุงูููุฏูู ููุฑุฃ **ุงูุฌูู ุงููู ูููุง ุนูุงูุฉ ูููุฉ ุจุงูุณุคุงู ุจุณ**.  
ุจููููู ุงูุชูููุฉุ ุจูุญุณูู ุงููุชุงุฆุฌุ ูุจูุฎูู ุงูู retrieval ูุงูุชูููุฏ ุฃูุซุฑ ุฏูุฉ ููุนุงููุฉ ๐ฏ  
---

# โ๏ธ ููุงุญุธุฉ ูููุฉ: ููููุนุด ุชูุฑูุฑ `node_postprocessor` ูุจุงุดุฑุฉ ูู `as_retriever`

ูู ูุธุงู **LlamaIndex**ุ ุงูู **node postprocessors** ูุง ุจุชุชุณุชุฎุฏูุด ูุจุงุดุฑุฉ ูุน ุงูู **retriever**.  
ุงูุณุจุจ ุฅู ูู ูุงุญุฏ ูููู ููู ุฏูุฑ ูุฎุชูู ูู ุงูู pipeline ๐  

- ุงูู **retriever** ูุณุคูููุชู ุฅูู **ูุฌูุจ ุงูู nodes** ุงููู ูููุง ุนูุงูุฉ ุจุงูุณุคุงู.  
- ุฃูุง ุงูู **node postprocessors** ูุจุชุดุชุบู **ุจุนุฏ ูุง ุงูู retriever ูุฑุฌูุน ุงููุชุงุฆุฌ**ุ  
  ูุจุชููู ุฌูุง **QueryEngine** ุนุดุงู ุชุนูู ููุชุฑุฉ ุฃู ุชุญุณูู ุฃู ุฅุนุงุฏุฉ ุชุฑุชูุจ ููู nodes ูุจู ุชูููู ุงูุฑุฏ ุงูููุงุฆู.

ุจุจุณุงุทุฉ ูุฏู:  
ุงูู **retriever** = ุจูุฌูุจ ุงูุฏุงุชุง ๐ฏ  
ุงูู **postprocessor** = ุจููุถูููุง ููุญุณูููุง ๐งน  

---

## โ๏ธ ุงูุทุฑููุฉ ุงูุตุญ ูุชูููู ุงูู QueryEngine ูุน Postprocessors

ุฏู ูุซุงู ุจุณูุท ุนูู ุฅุฒุงู ุชุถุจุท ุงูู `QueryEngine` ูุชุถูู ููู ุงูู `node_postprocessors` ุจุงูุทุฑููุฉ ุงูุตุญ:

```python
from llama_index.core import VectorStoreIndex, SimpleDirectoryReader
from llama_index.core.postprocessor import YourPostProcessOfChoice

# ุงูุฃูู ุจุชุฌูุฒ ุงู index ุจุชุงุนู
index = VectorStoreIndex.from_documents(docs)

# ุจุนุฏ ูุฏู ุจุชุนูู instance ูู postprocessor ุงููู ุนุงูุฒู
your_post_processor = YourPostProcessOfChoice(WhateverArgumentsYouNeedToPass)

# ููุง ุจุชุฑุจุท ุงู postprocessor ูุน ุงู query engine
query_engine = index.as_query_engine(
    ...,  # ุจุงูู ุฅุนุฏุงุฏุงุช ุงู query engine
    node_postprocessors=[your_post_processor]
)

# ุจุชููุฐ ุงุณุชุนูุงูู ุนุงุฏู
response = query_engine.query("your query")
```

---

## โ ุงูุฎูุงุตุฉ

ูู ุญุงููุช ุชูุฑูุฑ `node_postprocessor` ูุจุงุดุฑุฉ ูู `as_retriever`ุ  
ูุด ููุดุชุบู ูุฃู ุงูู retriever ูุง ูุนุฑูุด ูุชุนุงูู ูุน postprocessors.  

ุงูุตุญ ุฅูู **ุชุณุชุฎุฏููุง ุฌูู QueryEngine** ุจุนุฏ ุฎุทูุฉ ุงูุงุณุชุฑุฌุงุนุ  
ุนุดุงู ุชุถูู ุฅู ุงููุชุงุฆุฌ ุชุชุตููู ูุชุชุญุณูู ูุจู ูุง ุชุชุฌููุน ูู ุงูุฑุฏ ุงูููุงุฆู ๐ช  




</div>